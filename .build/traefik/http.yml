http:
  services:
    alkemio-web-service:
      loadBalancer:
        servers:
          - url: "http://alkemio_client/"

    kratos-public:
      loadBalancer:
        servers:
          - url: "http://kratos:4433/"

    kratos-admin:
      loadBalancer:
        servers:
          - url: "http://kratos:4434/"

    oathkeeper-proxy:
      loadBalancer:
        servers:
          - url: "http://oathkeeper:4455/"

    ipfs-http-adapter:
      loadBalancer:
        servers:
          - url: "http://ipfs:8080/"

      # - "traefik.tcp.routers.db.rule=HostSNI(`*`)"
      # - "traefik.tcp.services.db.loadbalancer.server.port=3306"
      # - "traefik.tcp.routers.db.entrypoints=mysql"

    mysql:
      loadBalancer:
        servers:
          - url: "mysql:3306"

  middlewares:
    strip-kratos-admin-prefix:
      stripPrefix:
        prefixes:
          - /identity/ory/kratos/admin
        forceSlash: false

    strip-kratos-public-prefix:
      stripPrefix:
        prefixes:
          - /identity/ory/kratos/public
        forceSlash: false

  routers:
    mysql:
      rule: "HostSNI(`*`)"
      service: "mysql"
      entryPoints:
        - "mysql"

    graphql:
      rule: "PathPrefix(`/graphql`)"
      service: "oathkeeper-proxy"
      entryPoints:
        - "web"

    graphql-admin:
      rule: "PathPrefix(`/admin/graphql`)"
      service: "oathkeeper-proxy"
      entryPoints:
        - "web"

    kratos-public:
      rule: "PathPrefix(`/identity/ory/kratos/public`)"
      service: "kratos-public"
      middlewares:
        - name: strip-kratos-public-prefix
      entryPoints:
        - "web"

    kratos-admin:
      rule: "PathPrefix(`/identity/ory/kratos/admin`)"
      service: "kratos-admin"
      middlewares:
        - name: strip-kratos-admin-prefix
      entryPoints:
        - "web"

    alkemiowebroute:
      rule: "PathPrefix(`/`)"
      service: "alkemio-web-service"
      entryPoints:
        - "web"

